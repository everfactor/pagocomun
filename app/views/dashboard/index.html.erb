<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-10">
    <h1 class="text-3xl font-bold tracking-tight text-gray-900"><%= t('dashboard.index.welcome', name: @user.first_name) %></h1>
    <p class="mt-2 text-lg text-gray-600"><%= t('dashboard.index.manage_units') %></p>
  </div>

  <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
    <% @active_assignments.each do |assignment| %>
      <% unit = assignment.unit %>
      <% organization = unit.organization %>
      <% payment_method = assignment.payment_method %>

      <div class="flex flex-col overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm transition hover:shadow-md">
        <div class="p-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div class="flex-shrink-0 bg-blue-100 rounded-lg p-2">
                <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6.75h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-900">
                  <%= t('activerecord.models.unit') %> <%= unit.number %> <%= unit.tower.present? ? "- #{unit.tower}" : "" %>
                </h3>
                <p class="text-sm font-medium text-gray-500 uppercase tracking-wider"><%= organization.name %></p>
              </div>
            </div>

            <% if payment_method&.active? %>
              <span class="inline-flex items-center rounded-full bg-green-50 px-2.5 py-0.5 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">
                <%= t('dashboard.index.autopay_active') %>
              </span>
            <% else %>
              <span class="inline-flex items-center rounded-full bg-yellow-50 px-2.5 py-0.5 text-xs font-medium text-yellow-700 ring-1 ring-inset ring-yellow-600/20">
                <%= t('dashboard.index.pending_enrollment') %>
              </span>
            <% end %>
          </div>

          <div class="space-y-3 mb-6">
            <div class="flex items-start text-sm text-gray-600">
              <svg class="h-5 w-5 text-gray-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
              </svg>
              <span><%= organization.address %></span>
            </div>

            <% if payment_method&.active? %>
              <div class="flex items-center text-sm text-gray-600">
                <svg class="h-5 w-5 text-gray-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75-3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75" />
                </svg>
                <span><%= payment_method.card_type %> <%= t('dashboard.index.ending_in', last_4: payment_method.card_last_4) %></span>
              </div>
            <% end %>
          </div>
        </div>

        <div class="mt-auto border-t border-gray-100 bg-gray-50 p-4">
          <div class="flex items-center justify-between">
            <%= link_to dashboard_index_path(user_id: @user.to_gid_param, unit_id: unit.to_gid_param), class: "text-sm font-semibold text-blue-600 hover:text-blue-500 flex items-center" do %>
              <%= t('dashboard.index.view_bills') %>
              <svg class="ml-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            <% end %>

            <% unless payment_method&.active? %>
              <%= button_to payment_methods_path(user_id: @user.to_gid_param, unit_id: unit.to_gid_param),
                  method: :post,
                  data: { turbo: false },
                  class: "inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600" do %>
                <svg class="-ml-0.5 mr-1.5 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                <%= t('dashboard.index.enroll_card') %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <% if @unit %>
    <div class="mt-12">
      <div class="border-b border-gray-200 pb-5 mb-6">
        <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
          <%= t('dashboard.index.bills_for_unit', unit: "#{@unit.number} #{@unit.tower}") %>
        </h2>
        <p class="mt-2 text-sm text-gray-500"><%= @unit.organization.name %></p>
      </div>

      <% if @bills&.any? %>
        <div class="overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"><%= t('dashboard.index.period') %></th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"><%= t('dashboard.index.amount') %></th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"><%= t('dashboard.index.status') %></th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"><%= t('dashboard.index.due_date') %></th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              <% @bills.each do |bill| %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium"><%= bill.period %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= number_to_currency(bill.amount, unit: "$", delimiter: ".", precision: 0) %></td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <% status_classes = case bill.status
                       when 'paid' then 'bg-green-100 text-green-800'
                       when 'pending' then 'bg-yellow-100 text-yellow-800'
                       else 'bg-gray-100 text-gray-800'
                       end %>
                    <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium <%= status_classes %>">
                      <%= bill.status.capitalize %>
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= bill.due_date&.strftime("%b %d, %Y") || 'N/A' %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <h3 class="mt-2 text-sm font-semibold text-gray-900"><%= t('dashboard.index.no_bills_found') %></h3>
          <p class="mt-1 text-sm text-gray-500"><%= t('dashboard.index.no_bills_detail') %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
